<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VideoConnect | Live Video Chat</title>
  <!-- Using CDN for Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Inline CSS to prevent missing file issues -->
  <style>
    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f5f5f5;
    }
    
    .app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    /* Header Styles */
    .app-header {
      background: #FF2D55;
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .logo i {
      margin-right: 0.5rem;
    }
    
    .nav-links {
      display: flex;
      gap: 1.5rem;
    }
    
    .nav-links a {
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    /* Hero Section */
    .hero {
      display: flex;
      flex: 1;
      padding: 2rem;
      align-items: center;
      justify-content: space-between;
    }
    
    .hero-content {
      max-width: 50%;
    }
    
    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: #FF2D55;
    }
    
    .hero p {
      font-size: 1.1rem;
      margin-bottom: 2rem;
      color: #666;
    }
    
    .action-buttons {
      display: flex;
      gap: 1rem;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .btn-primary {
      background: #FF2D55;
      color: white;
    }
    
    .btn-secondary {
      background: white;
      color: #FF2D55;
      border: 1px solid #FF2D55;
    }
    
    /* Auth Styles */
    .auth-container {
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      flex: 1;
    }
    
    .auth-tabs {
      display: flex;
      margin-bottom: 1.5rem;
      border-bottom: 1px solid #eee;
    }
    
    .auth-tab {
      flex: 1;
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    
    .auth-tab.active {
      border-bottom: 2px solid #FF2D55;
      font-weight: 600;
    }
    
    .auth-form {
      display: none;
    }
    
    .auth-form.active {
      display: block;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
    }
    
    .auth-btn {
      width: 100%;
      padding: 0.75rem;
      background: #FF2D55;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 1rem;
    }
    
    .auth-toggle {
      text-align: center;
      margin-top: 1rem;
      color: #FF2D55;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    /* Logged In Section */
    .quick-actions {
      display: flex;
      gap: 2rem;
      justify-content: center;
      padding: 2rem;
      flex-wrap: wrap;
    }
    
    .action-card {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      text-align: center;
      width: 200px;
      text-decoration: none;
      color: #333;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .action-card:hover {
      transform: translateY(-5px);
    }
    
    .action-card i {
      font-size: 2rem;
      color: #FF2D55;
      margin-bottom: 1rem;
    }
    
    .action-card h3 {
      margin-bottom: 0.5rem;
    }
    
    .action-card p {
      color: #666;
      font-size: 0.9rem;
    }
    
    /* Footer */
    .app-footer {
      background: #333;
      color: white;
      padding: 1rem;
      text-align: center;
      margin-top: auto;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
    }
    
    .footer-links a {
      color: white;
      text-decoration: none;
      font-size: 0.9rem;
    }
    
    /* Error Handling */
    .error-message {
      color: #ff2d55;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      display: none;
    }
    
    .input-error {
      border-color: #ff2d55 !important;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .hero {
        flex-direction: column;
        text-align: center;
      }
      
      .hero-content {
        max-width: 100%;
        margin-bottom: 2rem;
      }
      
      .action-buttons {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="logo">
        <i class="fas fa-video"></i>
        <span>VideoConnect</span>
      </div>
      <nav class="nav-links">
        <a href="/discover"><i class="fas fa-compass"></i> Discover</a>
        <a href="#" id="walletLink"><i class="fas fa-wallet"></i> <span id="walletBalance">0</span> coins</a>
        <a href="#" id="profileLink"><i class="fas fa-user"></i> Profile</a>
      </nav>
    </header>

    <!-- Hero Section (Shows when logged out) -->
    <section class="hero" id="heroSection">
      <div class="hero-content">
        <h1>Connect Through Video</h1>
        <p>Meet new people, make friends, and have fun through live video chats</p>
        <div class="action-buttons">
          <button id="showHostAuth" class="btn btn-primary">
            <i class="fas fa-broadcast-tower"></i> Start Broadcasting
          </button>
          <button id="showGuestAuth" class="btn btn-secondary">
            <i class="fas fa-users"></i> Join Rooms
          </button>
        </div>
      </div>
      <div class="hero-image">
        <!-- Placeholder for illustration -->
        <div style="width: 300px; height: 200px; background: #eee; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-video" style="font-size: 3rem; color: #ccc;"></i>
        </div>
      </div>
    </section>

    <!-- Auth Forms (Hidden by default) -->
    <section class="auth-container" id="authSection" style="display:none">
      <div class="auth-tabs">
        <div class="auth-tab active" data-tab="login">Login</div>
        <div class="auth-tab" data-tab="register">Register</div>
      </div>

      <!-- Login Form -->
      <div class="auth-form active" id="loginForm">
        <div class="form-group">
          <label for="loginUsername">Username</label>
          <input type="text" id="loginUsername" placeholder="Enter your username" required>
          <div class="error-message" id="loginUsernameError"></div>
        </div>
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" required>
          <div class="error-message" id="loginPasswordError"></div>
        </div>
        <button class="auth-btn" id="loginBtn">Login</button>
        <div class="auth-toggle" data-tab="register">Don't have an account? Register</div>
      </div>

      <!-- Register Form -->
      <div class="auth-form" id="registerForm">
        <div class="form-group">
          <label for="regUsername">Username</label>
          <input type="text" id="regUsername" placeholder="Choose a username" required>
          <div class="error-message" id="regUsernameError"></div>
        </div>
        <div class="form-group">
          <label for="regPassword">Password</label>
          <input type="password" id="regPassword" placeholder="Create a password" required>
          <div class="error-message" id="regPasswordError"></div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="isHostCheckbox"> Register as Host
          </label>
        </div>
        <button class="auth-btn" id="registerBtn">Register</button>
        <div class="auth-toggle" data-tab="login">Already have an account? Login</div>
      </div>
    </section>

    <!-- Logged In Content (Hidden by default) -->
    <section id="loggedInSection" style="display:none">
      <div class="quick-actions">
        <a href="/host" class="action-card" id="hostAction">
          <i class="fas fa-broadcast-tower"></i>
          <h3>Go Live</h3>
          <p>Start your broadcast</p>
        </a>
        <a href="/discover" class="action-card">
          <i class="fas fa-compass"></i>
          <h3>Discover Rooms</h3>
          <p>Find interesting streams</p>
        </a>
      </div>
    </section>

    <!-- Footer -->
    <footer class="app-footer">
      <div class="footer-links">
        <a href="#">Terms</a>
        <a href="#">Privacy</a>
        <a href="#">Help</a>
      </div>
    </footer>
  </div>

  <script>
    // Enhanced DOM ready handler
    document.addEventListener('DOMContentLoaded', () => {
      // Elements
      const heroSection = document.getElementById('heroSection');
      const authSection = document.getElementById('authSection');
      const loggedInSection = document.getElementById('loggedInSection');
      const walletBalance = document.getElementById('walletBalance');
      const profileLink = document.getElementById('profileLink');
      
      // Check authentication status
      const checkAuth = async () => {
        try {
          const response = await fetch('/api/auth/me', {
            credentials: 'include'
          });
          
          if (response.ok) {
            const { user } = await response.json();
            
            if (user) {
              // User is authenticated
              heroSection.style.display = 'none';
              authSection.style.display = 'none';
              loggedInSection.style.display = 'block';
              
              // Update UI based on user role
              if (user.isHost) {
                document.getElementById('hostAction').style.display = 'block';
              } else {
                document.getElementById('hostAction').style.display = 'none';
              }
              
              // Update profile info
              profileLink.href = `/profile?user=${user.username}`;
              walletBalance.textContent = '100'; // Default value
              
              return;
            }
          }
          
          // Not authenticated
          heroSection.style.display = 'flex';
          authSection.style.display = 'none';
          loggedInSection.style.display = 'none';
        } catch (error) {
          console.error('Auth check failed:', error);
          // Fallback to showing hero section
          heroSection.style.display = 'flex';
          authSection.style.display = 'none';
          loggedInSection.style.display = 'none';
        }
      };
      
      // Initialize auth check
      checkAuth();
      
      // Show auth forms
      document.getElementById('showHostAuth')?.addEventListener('click', () => {
        heroSection.style.display = 'none';
        authSection.style.display = 'block';
        document.getElementById('isHostCheckbox').checked = true;
      });
      
      document.getElementById('showGuestAuth')?.addEventListener('click', () => {
        heroSection.style.display = 'none';
        authSection.style.display = 'block';
        document.getElementById('isHostCheckbox').checked = false;
      });
      
      // Tab switching
      document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          // Update active tab
          document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Show corresponding form
          const tabName = tab.dataset.tab;
          document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
          document.getElementById(`${tabName}Form`).classList.add('active');
        });
      });
      
      // Toggle between login/register
      document.querySelectorAll('.auth-toggle').forEach(toggle => {
        toggle.addEventListener('click', () => {
          document.querySelector(`.auth-tab[data-tab="${toggle.dataset.tab}"]`).click();
        });
      });
      
      // Form validation
      const validateForm = (formId) => {
        let isValid = true;
        const form = document.getElementById(formId);
        
        form.querySelectorAll('input[required]').forEach(input => {
          const errorId = `${input.id}Error`;
          const errorElement = document.getElementById(errorId);
          
          if (!input.value.trim()) {
            input.classList.add('input-error');
            if (errorElement) {
              errorElement.textContent = 'This field is required';
              errorElement.style.display = 'block';
            }
            isValid = false;
          } else {
            input.classList.remove('input-error');
            if (errorElement) {
              errorElement.style.display = 'none';
            }
          }
        });
        
        return isValid;
      };
      
      // Login handler
      document.getElementById('loginBtn')?.addEventListener('click', async () => {
        if (!validateForm('loginForm')) return;
        
        try {
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            credentials: 'include',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              username: document.getElementById('loginUsername').value,
              password: document.getElementById('loginPassword').value
            })
          });
          
          if (response.ok) {
            window.location.reload();
          } else {
            const error = await response.json();
            alert(error.error || 'Login failed');
          }
        } catch (error) {
          alert('Login failed. Please try again.');
        }
      });
      
      // Register handler
      document.getElementById('registerBtn')?.addEventListener('click', async () => {
        if (!validateForm('registerForm')) return;
        
        try {
          const response = await fetch('/api/auth/register', {
            method: 'POST',
            credentials: 'include',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              username: document.getElementById('regUsername').value,
              password: document.getElementById('regPassword').value,
              isHost: document.getElementById('isHostCheckbox').checked
            })
          });
          
          if (response.ok) {
            window.location.reload();
          } else {
            const error = await response.json();
            alert(error.error || 'Registration failed');
          }
        } catch (error) {
          alert('Registration failed. Please try again.');
        }
      });
    });
  </script>
</body>
</html>