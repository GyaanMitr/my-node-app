<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VideoConnect | Live Video Chat</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Auth Form Styles */
    .auth-container {
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .auth-tabs {
      display: flex;
      margin-bottom: 1.5rem;
    }
    .auth-tab {
      flex: 1;
      padding: 0.75rem;
      text-align: center;
      cursor: pointer;
      border-bottom: 2px solid #eee;
    }
    .auth-tab.active {
      border-bottom: 2px solid #FF2D55;
      font-weight: 600;
    }
    .auth-form {
      display: none;
    }
    .auth-form.active {
      display: block;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .auth-btn {
      width: 100%;
      padding: 0.75rem;
      background: #FF2D55;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
    }
    .auth-toggle {
      text-align: center;
      margin-top: 1rem;
      color: #FF2D55;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="logo">
        <i class="fas fa-video"></i>
        <span>VideoConnect</span>
      </div>
      <nav class="nav-links">
        <a href="/discover"><i class="fas fa-compass"></i> Discover</a>
        <a href="#" id="walletLink"><i class="fas fa-wallet"></i> <span id="walletBalance">0</span> coins</a>
        <a href="#" id="profileLink"><i class="fas fa-user"></i> Profile</a>
      </nav>
    </header>

    <!-- Hero Section (Shows when logged out) -->
    <section class="hero" id="heroSection">
      <div class="hero-content">
        <h1>Connect Through Video</h1>
        <p>Meet new people, make friends, and have fun through live video chats</p>
        <div class="action-buttons">
          <button id="showHostAuth" class="btn btn-primary">
            <i class="fas fa-broadcast-tower"></i> Start Broadcasting
          </button>
          <button id="showGuestAuth" class="btn btn-secondary">
            <i class="fas fa-users"></i> Join Rooms
          </button>
        </div>
      </div>
      <div class="hero-image">
        <img src="images/hero-illustration.png" alt="Video Chat Illustration">
      </div>
    </section>

    <!-- Auth Forms (Hidden by default) -->
    <section class="auth-container" id="authSection" style="display:none">
      <div class="auth-tabs">
        <div class="auth-tab active" data-tab="login">Login</div>
        <div class="auth-tab" data-tab="register">Register</div>
      </div>

      <!-- Login Form -->
      <div class="auth-form active" id="loginForm">
        <div class="form-group">
          <label for="loginUsername">Username</label>
          <input type="text" id="loginUsername" placeholder="Enter your username">
        </div>
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password">
        </div>
        <button class="auth-btn" id="loginBtn">Login</button>
        <div class="auth-toggle" data-tab="register">Don't have an account? Register</div>
      </div>

      <!-- Register Form -->
      <div class="auth-form" id="registerForm">
        <div class="form-group">
          <label for="regUsername">Username</label>
          <input type="text" id="regUsername" placeholder="Choose a username">
        </div>
        <div class="form-group">
          <label for="regPassword">Password</label>
          <input type="password" id="regPassword" placeholder="Create a password">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="isHostCheckbox"> Register as Host
          </label>
        </div>
        <button class="auth-btn" id="registerBtn">Register</button>
        <div class="auth-toggle" data-tab="login">Already have an account? Login</div>
      </div>
    </section>

    <!-- Logged In Content (Hidden by default) -->
    <section id="loggedInSection" style="display:none">
      <div class="quick-actions">
        <a href="/host.html" class="action-card" id="hostAction">
          <i class="fas fa-broadcast-tower"></i>
          <h3>Go Live</h3>
          <p>Start your broadcast</p>
        </a>
        <a href="/discover" class="action-card">
          <i class="fas fa-compass"></i>
          <h3>Discover Rooms</h3>
          <p>Find interesting streams</p>
        </a>
      </div>
    </section>

    <!-- Footer -->
    <footer class="app-footer">
      <div class="footer-links">
        <a href="#">Terms</a>
        <a href="#">Privacy</a>
        <a href="#">Help</a>
      </div>
    </footer>
  </div>

  <script src="js/auth.js"></script>
  <script>
    // DOM Elements
    const heroSection = document.getElementById('heroSection');
    const authSection = document.getElementById('authSection');
    const loggedInSection = document.getElementById('loggedInSection');
    const walletLink = document.getElementById('walletLink');
    const profileLink = document.getElementById('profileLink');
    const walletBalance = document.getElementById('walletBalance');

    // Check auth status on page load
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const response = await fetch('/api/auth/me', { credentials: 'include' });
        const { user } = await response.json();
        
        if (user) {
          // User is logged in
          heroSection.style.display = 'none';
          authSection.style.display = 'none';
          loggedInSection.style.display = 'block';
          
          // Update wallet balance (fetch from API in real app)
          walletBalance.textContent = '2,450';
          
          // Update profile link
          profileLink.href = `/profile?user=${user.username}`;
          
          // Show/hide host action based on role
          document.getElementById('hostAction').style.display = user.isHost ? 'block' : 'none';
        } else {
          // User is not logged in
          heroSection.style.display = 'flex';
          authSection.style.display = 'none';
          loggedInSection.style.display = 'none';
        }
      } catch (err) {
        console.error('Auth check failed:', err);
      }
    });

    // Show auth forms
    document.getElementById('showHostAuth').addEventListener('click', () => {
      heroSection.style.display = 'none';
      authSection.style.display = 'block';
      document.getElementById('isHostCheckbox').checked = true;
    });

    document.getElementById('showGuestAuth').addEventListener('click', () => {
      heroSection.style.display = 'none';
      authSection.style.display = 'block';
      document.getElementById('isHostCheckbox').checked = false;
    });

    // Tab switching
    document.querySelectorAll('.auth-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}Form`).classList.add('active');
      });
    });

    // Toggle between login/register
    document.querySelectorAll('.auth-toggle').forEach(toggle => {
      toggle.addEventListener('click', () => {
        document.querySelector(`.auth-tab[data-tab="${toggle.dataset.tab}"]`).click();
      });
    });
  </script>
</body>
</html>